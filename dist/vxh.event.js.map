{"version":3,"sources":["vxh.event.js"],"names":["$vxh","event","validate","elem","error","getAttribute","length","setAttribute","removeAttribute","$","trigger","Event","init","document","body","on","ev","form","target","HTMLFormElement","invalid","add","elements","toArray","reduce","r","preventDefault","stopImmediatePropagation","focus","validity","closest","each","currentTarget","popover","is","children","activeElement","$elem","content"],"mappings":"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","file":"vxh.event.js","sourcesContent":["$vxh.event = (function(){\n\n    function validate(elem){\n        const error = $vxh.validate(elem);\n        if (error !== elem.getAttribute('data-error') ) {\n            if (error.length) {\n                elem.setAttribute('data-error', error);\n            } else {\n                elem.removeAttribute('data-error');\n            }\n            $(elem).trigger($.Event('validated.vx', { error }));\n        }\n        return error.length === 0;\n    }\n\n    function init() {\n\n        $(document.body).on('submit', (ev) => {\n            const form = ev.target;\n            if (form instanceof HTMLFormElement) {\n                const invalid = $('[data-vx-rule]', form).add(form.elements).toArray().reduce((r, elem) => {\n                    return validate(elem) ? r : r || elem;\n                }, null);\n                if (invalid) {\n                    ev.preventDefault();\n                    ev.stopImmediatePropagation();\n                    invalid.focus();\n                }\n            }\n        });\n\n        $(document.body).on('input', ev => {\n            if (ev.target.validity) {\n                validate(ev.target);\n            }\n            $(ev.target).closest('[data-vx-rule]').each(function(){\n                validate(this);\n            })\n        });\n\n        $(document.body).on('focus', '[data-error]', ev => {\n            $(ev.currentTarget).popover('show');\n        });\n\n        $(document.body).on('blur', '[data-error]', ev => {\n            $(ev.currentTarget).popover('hide');\n        });\n\n        $(document.body).on('mouseenter', '[data-error]', ev => {\n            $(ev.currentTarget).popover('show');\n        });\n\n        $(document.body).on('mouseleave', '[data-error]', ev => {\n            $(ev.target).is(':focus') || $(ev.target).children(':focus')\n            if (ev.target !== document.activeElement) {\n                $(ev.currentTarget).popover('hide');\n            }\n        });\n\n        $(document.body).on('validated.vx', ev => {\n            const $elem = $(ev.target);\n            if (ev.error) {\n                $elem.popover('dispose');\n                $elem.popover({\n                    trigger: 'manual',\n                    content: ev.error,\n                });\n                if (ev.target === document.activeElement) {\n                    $elem.popover('show');\n                }\n            } else {\n                $elem.popover('dispose');\n            }\n        });\n    }\n\n    return {\n        init,\n    };\n}());\n"]}