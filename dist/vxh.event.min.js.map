{"version":3,"sources":["vxh.event.js"],"names":["$vxh","event","validate","elem","error","getAttribute","length","setAttribute","removeAttribute","$","trigger","Event","init","document","body","on","ev","form","target","HTMLFormElement","invalid","add","elements","toArray","reduce","r","preventDefault","stopImmediatePropagation","focus","validity","closest","each","this","currentTarget","popover","is","children","activeElement","$elem","content"],"mappings":"aAAAA,KAAKC,MAAS,WAEV,SAASC,EAASC,GACd,IAAMC,EAAQJ,KAAKE,SAASC,GAS5B,OARIC,IAAUD,EAAKE,aAAa,gBACxBD,EAAME,OACNH,EAAKI,aAAa,aAAcH,GAEhCD,EAAKK,gBAAgB,cAEzBC,EAAEN,GAAMO,QAAQD,EAAEE,MAAM,eAAgB,CAAEP,MAAAA,MAEtB,IAAjBA,EAAME,OAgEjB,MAAO,CACHM,KA9DJ,WAEIH,EAAEI,SAASC,MAAMC,GAAG,SAAU,SAACC,GAC3B,IAAMC,EAAOD,EAAGE,OAChB,GAAID,aAAgBE,gBAAiB,CACjC,IAAMC,EAAUX,EAAE,iBAAkBQ,GAAMI,IAAIJ,EAAKK,UAAUC,UAAUC,OAAO,SAACC,EAAGtB,GAC9E,OAAOD,EAASC,GAAQsB,EAAIA,GAAKtB,GAClC,MACCiB,IACAJ,EAAGU,iBACHV,EAAGW,2BACHP,EAAQQ,YAKpBnB,EAAEI,SAASC,MAAMC,GAAG,QAAS,SAAAC,GACrBA,EAAGE,OAAOW,UACV3B,EAASc,EAAGE,QAEhBT,EAAEO,EAAGE,QAAQY,QAAQ,kBAAkBC,KAAK,WACxC7B,EAAS8B,UAIjBvB,EAAEI,SAASC,MAAMC,GAAG,QAAS,eAAgB,SAAAC,GACzCP,EAAEO,EAAGiB,eAAeC,QAAQ,UAGhCzB,EAAEI,SAASC,MAAMC,GAAG,OAAQ,eAAgB,SAAAC,GACxCP,EAAEO,EAAGiB,eAAeC,QAAQ,UAGhCzB,EAAEI,SAASC,MAAMC,GAAG,aAAc,eAAgB,SAAAC,GAC9CP,EAAEO,EAAGiB,eAAeC,QAAQ,UAGhCzB,EAAEI,SAASC,MAAMC,GAAG,aAAc,eAAgB,SAAAC,GAC9CP,EAAEO,EAAGE,QAAQiB,GAAG,WAAa1B,EAAEO,EAAGE,QAAQkB,SAAS,UAC/CpB,EAAGE,SAAWL,SAASwB,eACvB5B,EAAEO,EAAGiB,eAAeC,QAAQ,UAIpCzB,EAAEI,SAASC,MAAMC,GAAG,eAAgB,SAAAC,GAChC,IAAMsB,EAAQ7B,EAAEO,EAAGE,QACfF,EAAGZ,OACHkC,EAAMJ,QAAQ,WACdI,EAAMJ,QAAQ,CACVxB,QAAS,SACT6B,QAASvB,EAAGZ,QAEZY,EAAGE,SAAWL,SAASwB,eACvBC,EAAMJ,QAAQ,SAGlBI,EAAMJ,QAAQ,eAvEhB","file":"vxh.event.min.js","sourcesContent":["$vxh.event = (function(){\n\n    function validate(elem){\n        const error = $vxh.validate(elem);\n        if (error !== elem.getAttribute('data-error') ) {\n            if (error.length) {\n                elem.setAttribute('data-error', error);\n            } else {\n                elem.removeAttribute('data-error');\n            }\n            $(elem).trigger($.Event('validated.vx', { error }));\n        }\n        return error.length === 0;\n    }\n\n    function init() {\n\n        $(document.body).on('submit', (ev) => {\n            const form = ev.target;\n            if (form instanceof HTMLFormElement) {\n                const invalid = $('[data-vx-rule]', form).add(form.elements).toArray().reduce((r, elem) => {\n                    return validate(elem) ? r : r || elem;\n                }, null);\n                if (invalid) {\n                    ev.preventDefault();\n                    ev.stopImmediatePropagation();\n                    invalid.focus();\n                }\n            }\n        });\n\n        $(document.body).on('input', ev => {\n            if (ev.target.validity) {\n                validate(ev.target);\n            }\n            $(ev.target).closest('[data-vx-rule]').each(function(){\n                validate(this);\n            })\n        });\n\n        $(document.body).on('focus', '[data-error]', ev => {\n            $(ev.currentTarget).popover('show');\n        });\n\n        $(document.body).on('blur', '[data-error]', ev => {\n            $(ev.currentTarget).popover('hide');\n        });\n\n        $(document.body).on('mouseenter', '[data-error]', ev => {\n            $(ev.currentTarget).popover('show');\n        });\n\n        $(document.body).on('mouseleave', '[data-error]', ev => {\n            $(ev.target).is(':focus') || $(ev.target).children(':focus')\n            if (ev.target !== document.activeElement) {\n                $(ev.currentTarget).popover('hide');\n            }\n        });\n\n        $(document.body).on('validated.vx', ev => {\n            const $elem = $(ev.target);\n            if (ev.error) {\n                $elem.popover('dispose');\n                $elem.popover({\n                    trigger: 'manual',\n                    content: ev.error,\n                });\n                if (ev.target === document.activeElement) {\n                    $elem.popover('show');\n                }\n            } else {\n                $elem.popover('dispose');\n            }\n        });\n    }\n\n    return {\n        init,\n    };\n}());\n"]}